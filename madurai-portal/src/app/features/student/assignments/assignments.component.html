<div class="assignments-root">
  <h2 class="page-title">ğŸ“ Assignments</h2>

  <!-- ğŸ”— Button to My Submissions -->
  <div class="top-actions">
    <button mat-flat-button color="accent" routerLink="/student/my-submissions">
      ğŸ“¤ View All Submissions
    </button>
  </div>

  <!-- Batch selector -->
  <div class="batch-selector" *ngIf="batches.length > 1">
    <mat-form-field appearance="outline">
      <mat-label>Select Batch</mat-label>
      <mat-select [value]="batchId" (selectionChange)="onBatchChange($event.value)">
        <mat-option *ngFor="let b of batches" [value]="b.id">{{ b.name }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <mat-progress-spinner *ngIf="loading" mode="indeterminate"></mat-progress-spinner>

  <div *ngIf="error" class="error">{{ error }}</div>
  <div *ngIf="!loading && assignments.length === 0" class="empty">
    No assignments available.
  </div>

  <div class="assignments-grid">
    <mat-card *ngFor="let a of assignments" class="assignment-card">
      <mat-card-header>
        <mat-card-title>{{ a.title }}</mat-card-title>
        <mat-card-subtitle>
          <span>Deadline: {{ a.deadline ? (a.deadline | date:'short') : 'â€”' }}</span>
          <span class="status" [ngClass]="getDeadlineStatus(a.deadline)">
            {{ getDeadlineStatus(a.deadline) | uppercase }}
          </span>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="desc">{{ a.description }}</p>
        <div *ngIf="a.attachments?.length">
          <small>Attachments:</small>
          <div class="attach-list">
            <a *ngFor="let at of a.attachments" [href]="at.fileUrl" target="_blank">
              {{ at.fileName }}
            </a>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <!-- âœ… Conditional buttons -->
        <button mat-raised-button color="primary"
                *ngIf="!a.submission && getDeadlineStatus(a.deadline) !== 'overdue'"
                (click)="openAssignment(a)">
          Submit
        </button>

        <button mat-stroked-button color="accent"
                *ngIf="a.submission"
                (click)="openViewSubmission(a)">
          View Submission
        </button>

        <button mat-raised-button color="warn"
                *ngIf="!a.submission && getDeadlineStatus(a.deadline) === 'overdue'"
                disabled>
          Submission Closed
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
